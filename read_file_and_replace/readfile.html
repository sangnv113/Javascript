<!DOCTYPE html>
<html>
<title>...</title>

<head>
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="style/style.css">
    <script src="script/script.js" defer></script> -->
</head>
<style>
    /* body {background-color: powderblue;}
    h1   {color: blue;}
    p    {color: red;} */
 </style>
<body>
    <div>
        <div>
        <div id="rdTypeInput">
            <input type="radio" id="file" name="typeInput" value="file"> File
            <input type="radio" id="text" name="typeInput" value="text" checked="checked"> Text 
          </div>
        <input type="file" accept="text/plain" name="inputfile" id="inputfile">
    </div>
    <br>
        <textarea  style='width: 100px; height: 200px;' id = 'textRepl'></textarea>
        <br>
        <textarea  style='width: 400px; height: 400px;;' id = 'input'></textarea>
        <input type = 'submit'>
        <p>result:</p>
        <textarea  style='width: 400px; height: 400px;' id = 'output'></textarea>

    </div>
    <script>
        var split ='\n';
        var trSplitLine ='`';
        var trSplitElement ='^';
        
        
        
        document.getElementById('textRepl').textContent = 'a^g';
        var file = document.getElementById('inputfile');
        // file.addEventListener('change', () => {
        var ele = document.getElementsByName('typeInput');
        var typeInput =''  ; 
            for(i = 0; i < ele.length; i++) {
                if(ele[i].checked)
                typeInput = ele[i].value;
            }
        
            // if(typeInput=='file'){
                file.addEventListener('change', () => {
                    var textRepl = document.getElementById('textRepl').value;
                    var txtArr = [];
                    var fr = new FileReader();
                    fr.onload = function () {
                        // By lines
                        var lines = this.result.split(split);
                        for (var line = 0; line < lines.length; line++) {
                            if(textRepl != ''){
        
                                var trLines = textRepl.split(trSplitLine);
                                var trResult = lines[line];
                                for (var trLine = 0; trLine < trLines.length; trLine++) {
                                    var trElements= trLines[trLine].split(trSplitElement);
                                    trResult=trResult.replaceAll(trElements[0],trElements[1]);
                                }
                                txtArr.push(trResult);
                            }
        
                            // txtArr = [...txtArr, ...(lines[line].split(split))];
                        }
                    }
                    fr.onloadend = function () {
                        console.log(txtArr);
                        document.getElementById('output').textContent = txtArr.join('\n');
                    }
        
                    fr.readAsText(file.files[0]);
                })

            // }else{

            // }
    </script>
</body>

</html>